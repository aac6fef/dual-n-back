# 下一步开发计划：第三阶段 - 前后端集成与功能完善

根据 `dev_log.md` 的记录，项目已经完成了前端 UI/UX 的设计与实现（开发计划的第二阶段），目前所有界面均使用模拟数据。

下一步的核心任务是进入**开发计划的第三阶段：前后端集成**，将 React 前端与 Rust 后端通过 Tauri 的接口连接起来，并为后续的功能完善做准备。

---

### **任务 1：设置页面 (`SettingsPage.tsx`) 功能集成**

*   **目标**: 实现用户设置的加载与保存。
*   **步骤**:
    1.  **加载设置**:
        *   在 `SettingsPage` 组件加载时，调用 Tauri 命令 `invoke('load_user_settings')`。
        *   将从后端获取的 `UserSettings` 数据填充到对应的 UI 组件中（例如 N-Level、速度滑块、网格大小等）。
        *   **处理首次加载**：如果加载失败（例如新用户），则在前端使用一套默认设置，并显示在界面上。
    2.  **保存设置**:
        *   为“保存”按钮或在设置项变更时（可使用 `debounce` 技术防止频繁调用），绑定事件。
        *   收集当前界面上所有设置项的值，构建 `UserSettings` 对象。
        *   调用 Tauri 命令 `invoke('save_user_settings', { settings: ... })` 将数据发送到后端。
        *   调用成功后，向用户显示一个短暂的成功提示（如 "设置已保存"）。

### **任务 2：核心游戏流程 (`GamePage.tsx`) 集成**

*   **目标**: 实现完整的游戏生命周期，由后端逻辑驱动。
*   **步骤**:
    1.  **状态管理**:
        *   在 `GamePage` 中使用 `useState` 或 `useReducer` 来管理从后端获取的 `GameState`。
    2.  **开始游戏**:
        *   修改“开始游戏”按钮的逻辑，使其调用 Tauri 命令 `invoke('start_game')`。
        *   调用成功后，立即调用 `invoke('get_game_state')` 获取第 0 回合的初始状态。
        *   使用返回的 `GameState` 更新 UI，显示第一个视觉刺激和播放第一个听觉刺激。
    3.  **用户输入与回合推进**:
        *   修改“位置匹配”和“声音匹配”按钮的逻辑。
        *   每次用户点击后，收集用户的输入（`position_match`, `audio_match`），并调用 `invoke('submit_user_input', { userInput: ... })`。
        *   `submit_user_input` 调用成功后，**立即再次调用** `invoke('get_game_state')` 以获取下一回合的状态。
        *   用新获取的 `GameState` 更新 UI，形成游戏循环。
    4.  **结束游戏**:
        *   在每次从 `get_game_state` 获取状态后，检查 `is_running` 字段。
        *   当 `is_running` 为 `false` 时，表示游戏已结束。
        *   前端界面应切换到游戏结果展示状态，显示本次游戏的统计数据（`visual_stats`, `audio_stats`）。
        *   后端会自动保存会话，前端只需引导用户至历史记录页面或返回主菜单。

### **任务 3：历史记录页面 (`HistoryPage.tsx`) 集成**

*   **目标**: 展示真实的游戏历史数据和统计图表。
*   **步骤**:
    1.  **加载历史数据**:
        *   在 `HistoryPage` 组件加载时，调用 Tauri 命令 `invoke('get_game_history')`。
        *   将返回的 `GameSession` 数组替换掉当前的模拟数据。
    2.  **渲染数据**:
        *   将真实的会话数据传递给 `recharts` 图表组件，动态生成准确率和难度变化图。
        *   渲染历史会话列表。
        *   处理历史记录为空的初始状态，显示友好提示。

### **任务 4：完善基础功能（第四阶段部分内容前置）**

*   **目标**: 提升应用的基础体验和健壮性。
*   **步骤**:
    1.  **全局加载与错误处理**:
        *   在调用 `invoke` 时，统一处理加载状态（`loading`），在关键操作期间禁用按钮或显示加载指示器。
        *   统一处理 `invoke` 可能返回的 `Err`，向用户显示清晰的错误信息。
    2.  **国际化 (i18n) 实现**:
        *   引入 `i18next` 和 `react-i18next` 库。
        *   将 `src/pages` 和 `src/components` 中的所有硬编码文本（如 "开始游戏", "设置"）替换为 `t('key')` 的形式。
        *   完成设置页面中的语言切换功能，使其能够动态改变整个应用的语言。
